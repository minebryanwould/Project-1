local player = game.Players.LocalPlayer
local defaultSpeed = 20
local boostedSpeed = 40
local jumpResetTime = 0.4
local jumpCounter = 0
local lastJumpTime = 0
local currentSpeed = defaultSpeed
local humanoid = nil

local function setupCharacter(character)
    humanoid = character:WaitForChild("Humanoid")
    humanoid.WalkSpeed = defaultSpeed

    local function resetJumpCounter()
        jumpCounter = 0
    end

    humanoid.StateChanged:Connect(function(_, newState)
        if newState == Enum.HumanoidStateType.Jumping then
            local currentTime = tick()

            if currentTime - lastJumpTime > jumpResetTime then
                resetJumpCounter()
            end

            jumpCounter = jumpCounter + 1
            lastJumpTime = currentTime

            if jumpCounter == 3 then
                resetJumpCounter()
                if currentSpeed == defaultSpeed then
                    currentSpeed = boostedSpeed
                else
                    currentSpeed = defaultSpeed
                end
                humanoid.WalkSpeed = currentSpeed
            end
        end
    end)

    game:GetService("RunService").Heartbeat:Connect(function()
        if humanoid.WalkSpeed ~= currentSpeed then
            humanoid.WalkSpeed = currentSpeed
        end
    end)
end

if player.Character then
    setupCharacter(player.Character)
end

player.CharacterAdded:Connect(setupCharacter)
