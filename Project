local player = game.Players.LocalPlayer
local defaultSpeed = 20
local boostedSpeed = 40
local jumpResetTime = 0.2

local function setupCharacter(character)
    local humanoid = character:WaitForChild("Humanoid")
    humanoid.WalkSpeed = defaultSpeed

    local jumpCounter = 0
    local lastJumpTime = 0
    local isJumping = false
    local currentSpeed = defaultSpeed

    local function resetJumpCounter()
        jumpCounter = 0
    end

    humanoid.StateChanged:Connect(function(_, newState)
        if newState == Enum.HumanoidStateType.Jumping and not isJumping then
            isJumping = true
            local currentTime = tick()

            if currentTime - lastJumpTime > jumpResetTime then
                resetJumpCounter()
            end

            jumpCounter += 1
            lastJumpTime = currentTime

            if jumpCounter == 3 then
                resetJumpCounter()
                if currentSpeed == defaultSpeed then
                    currentSpeed = boostedSpeed
                else
                    currentSpeed = defaultSpeed
                end
                humanoid.WalkSpeed = currentSpeed
            end
        elseif newState == Enum.HumanoidStateType.Landed then
            isJumping = false
        end
    end)

    humanoid:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
        if humanoid.WalkSpeed ~= currentSpeed then
            humanoid.WalkSpeed = currentSpeed
        end
    end)
end

if player.Character then
    setupCharacter(player.Character)
end

player.CharacterAdded:Connect(setupCharacter)
